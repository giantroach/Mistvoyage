# 要件
- テキストがメインのオフラインゲームを制作します。
- 原則としてWeb開発とし、github pagesでアクセスでき、localstorageにセーブデータを保存します。
- 最終的にはmobile appとしてコンパイルし、リリースできると良いです。
- 原則としてバックエンドは使用しません。ウェブブラウザ内で完結します。
- 設定ファイルはjson形式とし、このjsonを編集することでコンテンツの追加が出来るものとします。

# ゲームの概要
- これはテキストベースのローグライトゲームです。
- ストーリーはほぼありません。
- ゲームは3つのチャプターに分かれており、各チャプターで異なる難易度の海域を旅します。
- 各チャプターでは規定数の「イベント」こなすことで「ボスイベント」に対峙します。
- 各チャプターでは事前に「スタート地点」から「最終イベント」までのツリー構造のようなマップが構築されます。ただし各枝は最大3つであり、「スタート地点」と「最終イベント」で一つに収束します。
- プレイヤーはSight値に応じてこのマップの一部を見ることができます(最大で2つ先まで)。
- イベントには「戦闘イベント」「航海イベント」「エンカウンターイベント」「飢餓イベント」など様々なものがあり、その種類、内容、発生条件などがJSONで定義されます。この定義を更新することで無限にゲームが拡張できるものとします。
- 各イベントにはイベントタイプと難易度が設定されており、プレイヤーは提示される最大三つのイベントからEncounterする任意のものを選択します。この際、プレイヤーが見られるのはイベントタイプのみです。ただし、イベント難易度に対し、Sightパラメターが低すぎる場合、イベントタイプは表示されず「???」が代わりに表示されます。
- 戦闘は原則としてオートバトルとし、戦闘中はプレイヤーが操作することはできません。戦闘ログやパラメータの増減を楽しみます。
― 「港イベント」では買い物や船の修理が行えます。
― 幾つかのイベントはSequencialであり、最初のイベントの選択肢に応じて後続のイベントが、ゲーム中のランダムなタイミングで発生します。またそのようなイベントが定義できるものとします。

# Parameter
プレイヤーには以下のパラメータがあり、その一部はプレイヤーに開示され、その一部は内部的にのみ使用される。
開示されるパラメータは画面上部に簡易的に表示される。

## Ship
- 公開パラメータ
- ゲーム開始時に選択し、ゲーム中に変更されることは原則としてない。ごく特殊なイベントによる変更は認める。
- Shipごとに後述のHull, Crewの上限とSpeed、Storage、Weapon Slot、Weaponが設定されている。
- Shipごとに特殊なルールをもつ事がある。
― 初期ShipのHullの上限は100, Crewの上限は10。Storageは8。Weapon slotは2。WeaponはHarpoon。

## Hull
- 公開パラメータ
- HPにあたるもの。0になるとゲームオーバー。
- 港で修理をすることで回復が出来る。

## Speed
― 非公開パラメータ
- イベントで参照される。
- Crew数に応じて補正される。
― 天候により補正される。

## Storage
- 公開パラメータ。
- イベント等で入手できるRelicを幾つ保持できるかの値。

## Food
- 公開パラメータ
― 毎ラウンド消費するほか、特定のイベントで増減する。
- 港で購入が出来る。
- 0になると即座にはゲームオーバーにならないものの、ネガティブな特殊イベントが発生するようになり、急速にゲームオーバーに近づく。
- 初期値は20。

## Money
― 公開パラメータ。
- 港で修理やFoodの購入に使用される。
- モンスターの撃破や特定のイベントにより増減する。
- 初期値は50。

## Crew
- 公開パラメータ
- 値が低くなるほど
- 0になるとゲームオーバー。

## Sight
― 公開パラメータ
― 船の進路を決定する際やイベント時に参照される。
- Crew数に応じて補正される。
- 天候により補正される。

## Weather
― 公開パラメータ
- Sight値やSpeed値に影響する。
― イベントで参照される。

## Karma
- 非公開パラメータ
― 悪いイベントをこなすごとに値が増え、良いイベントが発生する確立が上がる。
- 良いイベントをこなすごとに値が減り、悪いイベントが発生する確立が増える。

## Relic
- 公開パラメータ
― 装備品のようなもので、様々なパラメータに作用する。

## Weapon Slot
― 公開パラメータ
- Weaponを幾つ装備できるかの値。

## Weapon
― 公開パラメータ
- 戦闘で参照される。

# マップ
- マップはチャプター開始時にランダムに生成されます。
- マップはイベントの集合であり、各イベントは最大3つの枝を持つツリー構造となっています。
- マップは常に「スタート地点」から始まり、「ボスイベント」に収束して終わります。
- マップは「イベント」のタイプのみがアサインされ、実際のイベントはプレイヤーの選択時にランダムに選択されます。
- プレイヤーは周辺の海域のイベントを上部のメニューから最大で3つ先まで見ることができます。
- イベントのタイプは以下の通りです。
    - 「???」: 何が起こるか分かりません。
    - 「モンスター」: 戦闘になります。勝利することで「金」や、低確率で「武器」や「レリック」を入手できます。
    - 「エリートモンスター」: 通常より強力なモンスターと戦闘になります。勝利することで「武器」や「レリック」入手できます。
    - 「港」：港へ立ち寄り、「武器」や「レリック」の買い物や修理が行えます。
    - 「ボス」：チャプターの終わりに配置されるボスとの戦闘イベントです。
    - 「スタート地点」: チャプターのスタート地点です。特に効果はありません。
    - 「宝」: レリックを入手できるイベントです。
- 各イベントの出現頻度はJSONファイルで定義できるものとします。game.jsonとはファイルを分け、また海域ごとに設定が出来るような構造にしてください。
- 「港」は固定回数出現し、「???」は高確率で発生、「宝」は低確率で発生するという具合に定義できるものとします。
- チャプターごとに必用イベント数もこの定義jsonに定義するようにします。

## 追加要件1
- マップ上のイベントを次のレイヤの一つ以上のイベントと線でつなげてください。また、線でつながったイベントしか選択出来なくしてください。
- 各レイヤには最大4つのイベントを配置してください。また手前のレイヤーから線の繋がっていないorphanが起きないようにしてください。
- スクロールにより最終レイヤまで線のつながりを確認できるようにしてください。ただし、3つ以上先のレイヤのイベントタイプは「???」でマスクしてください。

## 追加要件2
- マップの生成時、レイヤ内に2つ以上ノードがある場合、その全てが同じイベントタイプにならないようにします。
- 「エリートモンスター」イベントはスタートノードから2マス以内には配置されません。また各海域に最低幾つ、最大幾つ配置されるか、海域の設定にて定義します。
- 「宝」に関しても海域の設定にて最低幾つ、最大幾つを定義します。

# イベント

## モンスター
- モンスタータイプのイベントノードを選択後、モンスターとの戦闘が発生します。
- 出現するモンスターは海域に定義されたモンスターからランダムにピックされます。
- モンスターは1-3体出現します。これらの組み合わせも海域に定義されるものとします。
- 戦闘はオートバトルで行われます。
- プレイヤーは戦闘ログから戦いの進行を観測します。
- 各武器にはクールダウンがあり、クールダウン後自動的に使用されます。
    - Crew数に応じてクールダウンに補正が入ります。Crew数が船の上限の半分より少ない場合、クールダウンが徐々に増えます。
- 各武器には命中精度があり、その確立を元に、幾つかの補正をもって最終的な命中率が計算されます。
    - モンスターのスピードと船のスピードを比較し、自分側が遅い場合は命中率が下がります。逆に自分が早い場合は命中率が上がります。
    - Sight値(天候による補正を加味した)を確認し、規定値より低い場合は命中率が下がります。
- 各武器にはダメージのレンジの設定があり、たとえば「2-6」であれば2から6の間のランダムな値がダメージとなります。
- プレイヤーは複数の武器を扱う事が出来ます。各武器の命中率はクールダウンは独立しています。
- モンスターもプレイヤーと原則として同様の判定を行います。
    - ただし、モンスターにはCrew数がないため、ライフの残量を参照します。
    - ライフの残量が減るほどモンスターは狂暴化し、クールダウンが減り、命中精度が落ちます。
- モンスターのHPはバーチャートで表示してください。具体的な数字は表示しないでください。
- モンスターを撃破後、金を獲得します。
    - 金以外も今後獲得できるようにしますがひとまずは金だけを実装します。
- 各補正値は今後調整することとなるのでコンフィグファイルに分けてください。
